(()=>{"use strict";const e=window.wp.i18n;function t(e,t){let a=JSON.parse(localStorage.getItem("mpg_state"))||{};a[e]=t,localStorage.setItem("mpg_state",JSON.stringify(a))}localStorage.getItem("mpg_state")||localStorage.setItem("mpg_state",JSON.stringify({}));const a='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10px" height="10px" viewBox="0 0 20 20" version="1.1"><g id="surface1"><path style=" stroke:none;fill-rule:nonzero;fill:rgb(20%,20%,20%);fill-opacity:1;" d="M 19.800781 18.484375 L 11.296875 9.992188 L 19.789062 1.527344 L 18.53125 0.203125 L 10.003906 8.703125 L 1.574219 0.289062 L 0.253906 1.546875 L 8.710938 9.992188 L 0.199219 18.472656 L 1.457031 19.796875 L 10 11.28125 L 18.472656 19.742188 Z M 19.800781 18.484375 "/></g></svg>';function r(e){const t=JSON.parse(localStorage.getItem("mpg_state"))||null;return t[e]?t[e]:null}function n(e){let t=[];return e?.forEach((e=>{let a="";a=e.startsWith("mpg_")?e.toLowerCase():`mpg_${e.toLowerCase()}`,t.push({title:a})})),t}function o(e){let t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select();let a=document.execCommand("copy");return document.body.removeChild(t),a}function i(e,t){let r=`<div contenteditable="false" class="shortcode-chunk">${e}<span class="close">${a}</span></div>`;return 0===t||1===t?`${r}-`:r}function s(){return location.href.includes("mpg-project-builder&action=edit_project&id=")?new URL(location.href).searchParams.get("id"):null}function c(e){const t=jQuery("#mpg_url_constructor");t.empty(),e.includes("mpg_url")?t.append(i("mpg_url")).trigger("input"):e.forEach(((e,a)=>{if(a<=2){let r="";r=e.includes("mpg_")?e.toLowerCase():`mpg_${e.toLowerCase()}`,t.append(i(r.replace(" ","_"),a)).trigger("input")}}))}function l(t,a){let r=new Option((0,e.__)("Insert shortcode","multi-pages-plugin"),null,!1,!0);r.disabled=!0,a.append(r),t.forEach(((e,t)=>{a.append(new Option(u(e.replace(/ /g,"_")),t))}))}function u(e){return e.toLowerCase().startsWith("mpg_")?e.toLowerCase():`mpg_${e.toLowerCase()}`}function p(e,t,a=null){let r=document.getElementById(e),n=r.scrollTop,o=0,i=r.selectionStart||"0"==r.selectionStart?"ff":!!document.selection&&"ie";if("ie"==i){r.focus();let e=document.selection.createRange();e.moveStart("character",-r.value.length),o=e.text.length}else"ff"==i&&(o=r.selectionStart);a&&(o=a);let s=r.value.substring(0,o),c=r.value.substring(o,r.value.length);if(r.value=s+t+c,o+=t.length,"ie"==i){r.focus();let e=document.selection.createRange();e.moveStart("character",-r.value.length),e.moveStart("character",o),e.moveEnd("character",0),e.select()}else"ff"==i&&(r.selectionStart=o,r.selectionEnd=o,r.focus());r.scrollTop=n}function d(e){let t="",a=jQuery.parseHTML(e);return jQuery.each(a,(function(e,a){let r=jQuery(a);r.hasClass("shortcode-chunk")?(r.find("span").remove(),t+="{{"+r.text().replace(/ /g,"_")+"}}"):t+=r.text()})),t}function _(e){let a,r=e.data.headers;return!!r&&(a="string"==typeof r?JSON.parse(r):Object.values(r),t("headers",a),!0)}function m(e=null){let t="";const a=f();if(a){let e="";a.forEach((t=>{e+=`${u(t.key)}${t.operator}${t.value};`})),t=` where="${e}"`}let n="";a&&a.length>0?(jQuery(".operator-selector-block").css("display","flex"),n=` logic="${jQuery("#mpg_operator_selector option:selected").val()}"`):jQuery(".operator-selector-block").hide();let o="",i=r("headers");i&&i[0]&&i[1]&&(o=e?`<a href="${d(e)}">{{${u(i[1])}}}</a><br>`:`<a href="${d(jQuery("#mpg_url_constructor").html())}">{{${u(i[1])}}}</a><br>`);const s=r("limit"),c=r("direction")?` direction="${r("direction")}"`:"",l=r("order-by")?` order-by="${r("order-by")}"`:"",p=r("unique-rows")?` unique-rows="${r("unique-rows")}"`:"";let _=`[mpg project-id="${r("projectId")}"${n}${t}${p}${l}${c} limit="${s}"]\n    ${o}\n[/mpg]`;jQuery("#mpg_shortcode_sandbox_textarea").val(""),jQuery("#mpg_shortcode_sandbox_textarea").val(_)}function g(t){return`<div class="condition-row">\n  <select class="mpg_headers_condition_key_dropdown input-data">\n    <option value="not-set" selected>-- Not set --</option>${t}</select>\n   <select class="mpg_rule_operator input-data">\n        <option value="=" selected>=</option>\n        <option value="!=" >!=</option>\n        <option value=">" >></option>\n        <option value="<" ><</option>\n        <option value=">=" >>=</option>\n        <option value="<=" ><=</option>\n    </select>\n  <select disabled="disabled" class=" mpg_headers_condition_value_dropdown input-data">\n    <option disabled selected>${(0,e.__)("Choose header at first","multi-pages-plugin")}</option>\n  </select>\n  <button class="add-new-condition" style="display: inline-flex;"><span class="dashicons dashicons-no-alt"></span></button>\n</div>`}let y=jQuery(".shortcode-headers-dropdown");function h(){let e=[];jQuery(".condition-row").each((function(){let a=jQuery(this).find(".mpg_headers_condition_key_dropdown option:selected").text(),r=jQuery(this).find(".mpg_headers_condition_value_dropdown option:selected").text(),n=jQuery(this).find(".mpg_rule_operator").val();"<"!==n&&"<="!==n||(n=n.replace("<","&lt;")),"-- Not set --"!==a&&(e.push({value:r,operator:n,key:a}),t("where",e))})),m()}function j(){jQuery(".shortcode-copy").on("click",(function(){o(jQuery("#mpg_shortcode_sandbox_textarea").val())&&toastr.success((0,e.__)("Shortcode copied to clipboard!","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin"),{timeOut:3e3})})),jQuery(".copy-shortcode-btn").on("click",(function(){let t=jQuery(".shortcode-preview-output"),a="";a=t.html().trim()?t.html():"{{"+y.find("option:first-child").val()+"}}",o(`${a}`)?toastr.success((0,e.__)("Shortcode copied to clipboard!","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin"),{timeOut:3e3}):toastr.warning((0,e.__)("Looks like something went wrong while copying shortcode","multi-pages-plugin"),(0,e.__)("Hmm","multi-pages-plugin"),{timeOut:3e3})})),jQuery(".project-builder").on("change",".mpg_headers_condition_key_dropdown",(async function(){let e=jQuery(this).val();jQuery(this).siblings(".mpg_headers_condition_value_dropdown").empty(),jQuery(".mpg_headers_condition_value_dropdown").prepend(jQuery("<option></option>").html("Loading..."));let a=await jQuery.post(ajaxurl,{action:"mpg_get_unique_rows_in_column",choosedColumnNumber:e,projectId:r("projectId"),securityNonce:backendData.securityNonce}),n=JSON.parse(a);n.success?(jQuery(this).siblings(".mpg_headers_condition_value_dropdown").empty(),n.data.forEach(((e,t)=>{jQuery(this).siblings(".mpg_headers_condition_value_dropdown").append(new Option(e,t))})),"not-set"===jQuery(this).find("option:checked").val()?(jQuery(this).siblings(".mpg_headers_condition_value_dropdown").attr("disabled","disabled"),t("where",[]),m()):jQuery(this).siblings(".mpg_headers_condition_value_dropdown").removeAttr("disabled")):toastr.error(n.error,"Error")})),jQuery(document).on("blur",".mpg_headers_condition_value_dropdown",(async function(){h()})),jQuery(document).on("blur",".mpg_rule_operator",(async function(){h()})),jQuery("#mpg_operator_selector").on("blur",(function(){let e=jQuery("#mpg_operator_selector option:selected").val(),t=jQuery("#mpg_shortcode_sandbox_textarea").val(),a=/logic="(.*?)"/gm.exec(t),r=t.replace(`logic="${a[1]}"`,`logic="${e}"`);jQuery("#mpg_shortcode_sandbox_textarea").val(r)})),jQuery(document).on("click",".add-new-rule",(function(e){let t;e.preventDefault(),r("headers").forEach(((e,a)=>{const r=e.startsWith("mpg_")?e:`mpg_${e}`;t+=`<option value="${a}" >${r}</option>`})),jQuery(".condition-container").append(g(t))})),jQuery(".condition-container").on("click","button",(function(){if(jQuery(this).hasClass("btn-success")){let e;jQuery(".condition-row").find("button:eq(0)").addClass("btn-danger").addClass("mpp-remove-action").removeClass("btn-success").html("-"),r("headers").forEach(((t,a)=>{const r=t.startsWith("mpg_")?t:`mpg_${t}`;e+=`<option value="${a}" >${r}</option>`})),jQuery(".condition-container").append(g(e))}else{let e=f(),a=jQuery(this).parent().find(".mpg_headers_condition_key_dropdown option:selected").text(),r=jQuery(this).parent().find(".mpg_headers_condition_value_dropdown option:selected").text(),n=jQuery(this).parent().find(".mpg_rule_operator").val();"<"!==n&&"<="!==n||(n=n.replace("<","&lt;")),e&&(e=e.filter((function(e){return e.key!==a||e.value!==r||e.operator!==n})),t("where",e)),jQuery(this).parent().remove(),m(e)}})),jQuery("#mpg_limit").on("change",(function(){t("limit",jQuery(this).val()),m()})),jQuery("#mpg_direction").on("change",(function(){const a=jQuery(this).find("option:checked").val();["asc","desc","random"].includes(a)?(t("direction",a),m(),jQuery("#mpg_order_by").attr("disabled","random"===a)):toastr.warning((0,e.__)("Choosed wrong direction","multi-pages-plugin"),(0,e.__)("Error","multi-pages-plugin"))})),jQuery("#mpg_order_by").on("change",(function(){t("order-by",jQuery(this).find("option:checked").text()),m()})),jQuery("#mpg_unique_rows").on("change",(function(){t("unique-rows",jQuery(this).find("option:checked").val().toLowerCase()),m()})),jQuery("#shortcode .shortcode-preview").on("click",(async function(){let t=jQuery("#mpg_shortcode_sandbox_textarea").val();try{const a=/project-id="(.*?)"/,r=/where="(.*?)"/,n=/logic="(.*?)"/,o=/order-by="(.*?)"/,i=/direction="(.*?)"/,s=/limit="(.*?)"/,c=/unique-rows="(.*?)"/;let l,u=/\[mpg.*?](.*?)\[\/mpg\]/.exec(t.replace(/\n/g,""));if(!u||!u[1])throw(0,e.__)("You need to fill some static content with shortcodes beetwen [mpg] [/mpg]","multi-pages-plugin");l=u[1];let p,d=a.exec(t.replace(/\n/g,""));d&&d[1]&&(p=d[1].trim());let _,m=r.exec(t.replace(/\n/g,""));m&&m[1]&&(_=m[1].trim());let g,y=n.exec(t.replace(/\n/g,""));y&&y[1]&&(g=y[1].trim());let h,j=s.exec(t.replace(/\n/g,""));j&&j[1]&&(h=j[1].trim());let f,b=o.exec(t.replace(/\n/g,""));b&&b[1]&&(f=b[1].trim());let Q,v=i.exec(t.replace(/\n/g,""));v&&v[1]&&(Q=v[1].trim());let w,k=c.exec(t.replace(/\n/g,""));k&&k[1]&&(w=k[1].trim());let x=await jQuery.post(ajaxurl,{action:"mpg_shortcode",content:l,projectId:p,where:_,operator:g,orderBy:f,direction:Q,limit:h,uniqueRows:w,securityNonce:backendData.securityNonce}),N=JSON.parse(x);if(!N.success)return void toastr.error(N.error,(0,e.__)("Error","multi-pages-plugin"));const S=N.data;if(S.includes('href="')&&!S.includes(backendData.baseUrl)){let e=S.replace(/href="/g,`href="${backendData.baseUrl}/`);jQuery(".mpg_list_preview-block").html(e)}else jQuery(".mpg_list_preview-block").html(N.data)}catch(t){toastr.warning(t,(0,e.__)("Incorrect input","multi-pages-plugin"))}}))}function f(){let e=r("where");return e&&0!==e.length?e[0].hasOwnProperty("operator")?e:(e=Object.keys(e).map((e=>({column:e,operator:"=",value:obj[e]}))),void t("where",e)):[]}async function b(t){let a=await jQuery.post(ajaxurl,{action:"mpg_get_posts_by_custom_type",custom_type_name:t.data.entity_type,template_id:t.data.template_id,securityNonce:backendData.securityNonce}),r=JSON.parse(a);if(!0!==r.success)throw r.error;let n=jQuery("#mpg_set_template_dropdown");n.empty(),r.data.forEach((a=>{if(a.id===parseInt(t.data.template_id))n.append(new Option(a.title,a.id,!1,!0));else if(a.is_home){let t=new Option(`${a.title} (${(0,e.__)("Front page","multi-pages-plugin")})`,a.id);t.disabled=!0,n.append(t)}else n.append(new Option(a.title,a.id))})),n.on("change",(function(){var e=jQuery(this).val();e?.includes("post-new")&&window.open(jQuery(this).val(),"_blank"),e>0&&jQuery(this).parent("div").removeClass("col-sm-12 pr-0").addClass("col-sm-9").next("#mpg_edit_template_link").removeClass("d-none disabled").attr("href",(function(){return jQuery(this).data("edit_link").replace("#id#",e)}))})),"direct_link"===t.data.source_type&&jQuery("#direct_link").click(),n.select2({placeholder:"post"===t.data.entity_type?(0,e.__)("+ Add new post","multi-pages-plugin"):`${(0,e.__)("+ Add new","multi-pages-plugin")} ${t.data.entity_type}`,width:"100%",minimumInputLength:3,ajax:{delay:250,url:ajaxurl,dataType:"json",method:"post",data:function(e){return{action:"mpg_get_posts_by_custom_type",custom_type_name:t.data.entity_type,q:e,securityNonce:backendData.securityNonce}},processResults:function(a){return"post"===t.data.entity_type?a.data.push({id:backendData.mpgAdminPageUrl+"post-new.php",title:(0,e.__)("+ Add new post","multi-pages-plugin")}):t.data.entity_type&&a.data.push({id:backendData.mpgAdminPageUrl+"post-new.php?post_type="+t.data.entity_type,title:(0,e.__)("+ Add new","multi-pages-plugin")+" "+t.data.entity_type}),{results:jQuery.map(a.data,(function(e){return{id:e.id,text:e.title,disabled:e.is_home||!1}}))}}}}).on("select2:close",(function(){var e=jQuery(this).val();e?.includes("post-new")&&jQuery(this).html("")}))}function Q(e,a){t("datasetFirstRow",e.data.rows[0]);const r=jQuery("#collapse_2 .summary");r.parents(".sub-section.d-none").removeClass("d-none");const o=r.text();r.text(o.replace("[rows]",e.data.totalRows).replace("[headers]",a?.length));let i=n(a);const s=jQuery("#mpg_dataset_limited_rows_table"),c={data:e.data.rows,columns:i,paging:!1,searching:!1,ordering:!1,retrieve:!0,language:{lengthMenu:"Show _MENU_ entries"},responsive:!0};s.DataTable(c).clear().destroy(),s.empty();let u=s.DataTable(c);try{let e=jQuery(".data-table-container").width(),t=0,a=jQuery("#mpg_dataset_limited_rows_table thead th"),r=[];jQuery.each(a,(function(a,n){t+=jQuery(n).outerWidth(),t>e&&r.push(a)})),u.columns(r).visible(!1)}catch(e){console.error(e)}const p=jQuery("#mpg_main_tab_insert_shortcode_dropdown");p.removeAttr("disabled").prop("disabled",!1),p.empty(),a&&l(a,p),jQuery("#mpg_url_constructor").attr("contenteditable",!0).trigger("input"),p.select2({width:"100%"})}function v(e){e.preventDefault();const t=r("projectId");if(!t)return;jQuery("#mpg_preview_all_urls").modal();const a=jQuery("#mpg_mpg_preview_all_urls_table"),n={serverSide:!0,columns:[{title:"mpg_url"}],paging:!0,searching:!0,retrieve:!0,ajax:{url:`${ajaxurl}?action=mpg_preview_all_urls&projectId=${t}&securityNonce=${backendData.securityNonce}`,type:"POST"},language:{lengthMenu:"Show _MENU_ entries"}};a.DataTable(n).clear().destroy(),a.empty(),a.DataTable(n)}y.on("change",(function(){let e=jQuery(this).val();jQuery(".shortcode-preview-output").html(`{{${e}}}`)}));class w{constructor(e){this.file=e,jQuery("#progress-wrp .progress-bar").css("width",0),jQuery("#progress-wrp .status").text("0%"),jQuery("#progress-wrp").show()}getType(){return this.file.type}getSize(){return this.file.size}getName(){return this.file.name}doUpload(){return new Promise(((t,a)=>{var n=this,o=new FormData;o.append("file",this.file,this.getName()),o.append("upload_file",!0),o.append("action","mpg_upload_file"),o.append("securityNonce",backendData.securityNonce),o.append("projectId",r("projectId")),jQuery.ajax({type:"POST",url:ajaxurl,xhr:function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",n.progressHandling,!1),e},success:function(e){jQuery("#progress-wrp").hide(),jQuery("#progress-wrp .progress-bar").css("width",0),t(e)},error:function(t,r,n){400===t.status||500===t.status?toastr.error((0,e.__)("Looks like you attempt to use large source file, that reached memory allocated to PHP or reached max_post_size. Please, increase memory limit according to documentation for your web server. For additional information, check .log files of web server or","multi-pages-plugin")+`<a target="_blank" style="text-decoration: underline" href="https://docs.themeisle.com/article/1443-500-internal-server-error"> ${(0,e.__)("read our article","multi-pages-plugin")}</a>.`,(0,e.__)("Server settings limitation","multi-pages-plugin"),{timeOut:3e4}):a(n)},async:!0,data:o,cache:!1,contentType:!1,processData:!1,timeout:6e4})}))}progressHandling(e){var t=0,a=e.loaded||e.position,r=e.total;e.lengthComputable&&(t=Math.ceil(a/r*100)),jQuery("#progress-wrp .progress-bar").css("width",+t+"%"),jQuery("#progress-wrp .status").text(t+"%")}}t("separator","-");var k=async function(){let a=s();const n=jQuery(".project-name").val(),o=jQuery("#mpg_entity_type_dropdown").val(),i=jQuery("#mpg_set_template_dropdown").val(),c=jQuery("#mpg_apply_condition").val(),l=jQuery(this).find("button");l.next("span.spinner").addClass("is-active"),l.attr("disabled",!0),a||(a=r("projectId"));const u={action:"mpg_upsert_project_main",projectId:a,projectName:n,entityType:o,templateId:i,applyCondition:c,excludeInRobots:jQuery("#mpg_exclude_template_in_robots").is(":checked"),participateInSearch:jQuery("#mpg_participate_in_search").is(":checked"),participateInDefaultLoop:jQuery("#mpg_participate_in_default_loop").is(":checked"),securityNonce:backendData.securityNonce};let p=await jQuery.post(ajaxurl,u),d=JSON.parse(p);if(!d.success)return void toastr.error((0,e.__)("Something went wrong while saving project data. Details:","multi-pages-plugin")+d.error,(0,e.__)("Can not update project","multi-pages-plugin"));let{projectId:_}=d.data;return t("projectId",a||_),delete u.securityNonce,delete u.projectName,Object.keys(u).forEach((e=>(null==u[e]||void 0===u[e])&&delete u[e])),jQuery('a[href="#shortcode"], a[href="#sitemap"],  a[href="#spintax"], .save-changes-block .save-changes').removeClass("disabled"),window?.tiTrk?.with("multi").set("save-changes-1",{feature:"dashboard-saved-changes",featureComponent:"project-main",value:u,groupId:r("projectId")}),window?.tiTrk?.uploadEvents(),r("projectId")};async function x(){if(jQuery(".cache-page .buttons .btn.disable-cache").length){const t=jQuery(".disable-cache").parent().attr("data-cache-type");console.log("cacheType",t),["disk","database"].includes(t)||console.error("Passed unsupported type of cache");let a=await jQuery.post(ajaxurl,{action:"mpg_cache_statistic",projectId:r("projectId"),type:t,securityNonce:backendData.securityNonce}),n=JSON.parse(a);n.success?(jQuery(".cache-page .pages-in-cache, .cache-page .cache-size").text("N/A"),jQuery(`.cache-page .${t} .pages-in-cache`).text(n.data.pagesCount),jQuery(`.cache-page .${t} .cache-size`).text(n.data.pagesSize)):toastr.error(n.error,(0,e.__)("Failed","multi-pages-plugin"))}else jQuery(".cache-page .pages-in-cache, .cache-page .cache-size").text("N/A")}jQuery(document).ready((async function(){const u=location.href.includes("mpg-project-builder&action=edit_project&id=")?new URL(location.href).searchParams.get("id"):null;u&&jQuery("#toplevel_page_mpg-dataset-library .wp-submenu a").each(((e,t)=>{new URLSearchParams(jQuery(t).attr("href")).get("id")===u&&jQuery(t).parent().addClass("current")})),jQuery(window).on("beforeunload",(function(){localStorage.removeItem("mpg_state")})),jQuery(".delete-project").on("click",(async function(t){if(t.preventDefault(),confirm((0,e.__)("Are you sure, that you want to delete project? This action can not be undone.","multi-pages-plugin"))){let t=await jQuery.post(ajaxurl,{action:"mpg_delete_project",projectId:s(),securityNonce:backendData.securityNonce}),a=JSON.parse(t);a.success||toastr.error(a.error,"Can not delete project"),toastr.success((0,e.__)("Your project was successfully deleted","multi-pages-plugin"),(0,e.__)("Deleted!","multi-pages-plugin")),setTimeout((()=>{location.href=backendData.datasetLibraryUrl}),3e3)}})),jQuery('select[name="periodicity"]').on("change",(function(){let e=jQuery(this).children("option:selected").val(),t=jQuery('.direct-link-schedule-form input[name="datetime_upload_remote_file"]'),a=jQuery('.direct-link-schedule-form select[name="notification_level"]'),r=jQuery('.direct-link-schedule-form input[name="notification_email"]');"once"!==e?jQuery(".mpg-date-changes").removeClass("mpg-hidden"):jQuery(".mpg-date-changes").addClass("mpg-hidden"),"now"!==e&&"once"!==e?("ondemand"!==e&&t.removeClass("disabled").attr("required","required"),a.removeClass("disabled").attr("required","required"),r.removeClass("disabled").attr("required","required"),jQuery(this).parents(".sub-section").find(".block-with-tooltip.sync-options.d-none").removeClass("d-none")):(a.addClass("disabled").removeAttr("required"),r.addClass("disabled").removeAttr("required")),"ondemand"===e?jQuery("#mpg-webhook-url").removeClass("d-none"):jQuery("#mpg-webhook-url").addClass("d-none")})),jQuery('select[name="notification_level"]').on("change",(function(){"do-not-notify"!==jQuery(this).children("option:selected").val()?jQuery(this).parents(".sub-section").find(".block-with-tooltip.nf-options").removeClass("d-none"):jQuery(this).parents(".sub-section").find(".block-with-tooltip.nf-options").addClass("d-none")})),jQuery(document).on("change","#mpg_entity_type_dropdown",(async function(){let e=jQuery(this).val();await b({data:{entity_type:e}})})),jQuery('input[name="mpg_upload_file_input"]').on("change",(async function(){var a=jQuery(this)[0].files[0],n=new w(a);jQuery('#direct_link input[name="direct_link_input"]').val(""),await k();let o=await n.doUpload(),i=JSON.parse(o);if(!i.success)throw i.error;t("source",{type:"upload_file",path:i.data.path}),toastr.success((0,e.__)("We will use this file as source","multi-pages-plugin"),(0,e.__)("Got it!","multi-pages-plugin"),{timeOut:5e3});let l=s();l||(l=r("projectId"));let u=await jQuery.post(ajaxurl,{action:"mpg_upsert_project_source_block",type:"upload_file",projectId:l,path:i.data.path,securityNonce:backendData.securityNonce}),p=JSON.parse(u);if(p.success||toastr.error((0,e.__)("Something went wrong while saving project data. Try reload page","multi-pages-plugin"),(0,e.__)("Can not update project","multi-pages-plugin")),!_(p))throw(0,e.__)("Can not get headers form source file","multi-pages-plugin");const d=r("headers");Q(p,d),p.data.url_structure||c(d),jQuery(this).parents(".sub-section").find(".use-direct-link-button").removeAttr("disabled")})),jQuery('input[name="direct_link_input"]').on("input",(function(){const e=jQuery(this).val();e&&e.includes("google.com")?jQuery(".worksheet-id").find("input").removeClass("disabled"):jQuery(".worksheet-id").find("input").addClass("disabled"),""!==e?(jQuery(".worksheet-id").next(".block-with-tooltip").find("select").removeClass("disabled"),jQuery(".use-direct-link-button").removeClass("disabled")):(jQuery(".worksheet-id").next(".block-with-tooltip").find("select").addClass("disabled"),jQuery(".use-direct-link-button").addClass("disabled"))})),jQuery('input[name="worksheet_id"]').on("input",(function(){"0"===jQuery(this).val()&&toastr.warning((0,e.__)("Worksheet ID cannot be zero. If your document has one sheet or you would like to use the first sheet - just keep this field empty","multi-pages-plugin"),(0,e.__)("Wrong worksheet id","multi-pages-plugin"),{timeOut:1e4})})),jQuery("#upload_file_tab").on("click",(function(){jQuery("#progress-wrp").hide()})),jQuery("#mpg_url_mode_group input").on("click",(function(){t("urlMode",jQuery("#mpg_url_mode_group input:checked").attr("id")),jQuery("#mpg_url_constructor").trigger("mpg_render_urls")})),jQuery("#mpg_preview_modal_link").on("click",(function(e){e.preventDefault(),jQuery("#mpg_preview_modal").modal();const t=r("headers");let a=s();a||(a=r("projectId"));const o=jQuery("#mpg_data_full_preview_table"),i={serverSide:!0,columns:n(t),retrieve:!0,resposive:!0,ajax:{url:`${ajaxurl}?action=mpg_get_data_for_preview&projectId=${a}&securityNonce=${backendData.securityNonce}`,type:"POST"},language:{lengthMenu:"Show _MENU_ entries"}};o.DataTable(i).clear().destroy(),o.empty(),o.DataTable(i)})),jQuery(".project-builder .spaces-replacer").on("click",(function(){jQuery(".project-builder .spaces-replacer").removeClass("active"),jQuery(this).addClass("active"),t("separator",jQuery(this).text()),jQuery("#mpg_url_constructor").trigger("mpg_render_urls")})),jQuery("#mpg_main_tab_insert_shortcode_dropdown").on("change",(function(){let e=jQuery("#mpg_main_tab_insert_shortcode_dropdown option:selected").text();jQuery("#mpg_url_constructor").append(i(e)).trigger("mpg_render_urls")})),jQuery("#mpg_url_constructor").on("click",".shortcode-chunk .close",(function(){jQuery(this).parent().remove(),jQuery("#mpg_url_constructor").trigger("mpg_render_urls")})),jQuery("#mpg_url_constructor").on("keydown",(function(t){if(toastr.options.preventDuplicates=!0,["<","(","[","{","\\","^","=","$","!","|","]","}",")","?","*","+",">","@","#","%",":",";","&","`","'",","].includes(t.key))return toastr.warning((0,e.__)("Unsupported char. Supported only _, -, /, ~, ., =","multi-pages-plugin"),"Warning"),!1})),jQuery("#mpg_url_constructor").on("mpg_render_urls input",(function(e,t){let a=jQuery(this).text();m(jQuery(this).html());let n="<ul>",o=function(e,t,a,r){t?.forEach(((t,a)=>{let n="";n=t.startsWith("mpg_")?t.toLowerCase():`mpg_${t.toLowerCase()}`;let o=(r[a]?r[a].toString():"").replace(/^\/+|\/+$/g,"");const i=new RegExp(`${n}`,"gi");e=e.replace(i,o)}));let n=e.replace(/\s+/gm,"mpgspaceholder");if(n=n.replace(/\//gm,"mpgslashholder").replace(/\./gm,"mpgdotholder").replace(/\-/gm,"mpgdashholder").replace(/\_/gm,"mpglodashholder").replace(/\~/gm,"mpgtildaholder").replace(/\=/gm,"mpgequalholder"),n=n.replace(/[^\p{L}\d]/gu,""),n=n.replace(/mpgspaceholder/gm,a).replace(/mpgslashholder/gm,"/").replace(/mpgdotholder/gm,".").replace(/mpgdashholder/gm,"-").replace(/mpglodashholder/gm,"_").replace(/mpgtildaholder/gm,"~").replace(/mpgequalholder/gm,"="),n){const[e,t]=backendData.baseUrl.split("?");return n=e+n.toLowerCase(),""!==backendData.lang_code&&t&&!t.includes("lang")&&(n=n.replace(backendData.lang_code,"/")),t?`${n}/?${t}`:`${n}/`}return backendData.baseUrl}(a,r("headers"),r("separator"),r("datasetFirstRow"));"without-trailing-slash"===r("urlMode")&&(o=o.replace(/\/$/,"")),"init"===t?(n+=`<li><a target="_blank" href="${o}">${o}</a></li>`,jQuery("#mpg_preview_all_urls_link").removeClass("disabled-link")):(n+=`<li>${o}</li>`,jQuery("#mpg_preview_all_urls_link").addClass("disabled-link")),n+="</ul>",jQuery("#mpg_preview_url_list").html(n)})),jQuery("#mpg_preview_all_urls_link").on("click",v),jQuery("#mpg_upload_file_input").on("change",(function(){var e=jQuery(this).val();jQuery(this).next(".mpg_upload_file-label").html(e)})),jQuery("#mpg_unschedule_task").on("click",(async function(){if(confirm((0,e.__)("Are you sure, that you want to unschedule task?","multi-pages-plugin"))){let t=await jQuery.post(ajaxurl,{action:"mpg_unschedule_cron_task",projectId:s(),securityNonce:backendData.securityNonce}),a=JSON.parse(t);if(!a.success)return toastr.error(a.error,(0,e.__)("Can not unschedule task","multi-pages-plugin")),!1;toastr.success((0,e.__)("Task was successfully unschedule","multi-pages-plugin"),(0,e.__)("Unscheduled!","multi-pages-plugin")),setTimeout((()=>{location.href=`${backendData.projectPage}&action=edit_project&id=${s()}`}),1e3)}})),jQuery(".save-changes-block").on("click",".save-changes",(async function(t){t.preventDefault();let a=!1;if(jQuery(".main-inner-content input, .main-inner-content select").each((function(e){jQuery(this).attr("required")&&!jQuery(this).val()&&jQuery(this).is(":visible")&&(jQuery(this)[0].reportValidity(),a=!0)})),!a){jQuery(this).parent(".save-changes-block").find("span.spinner").addClass("is-active"),jQuery(this).parent(".save-changes-block").find("button").attr("disabled",!0);var n=await k();await async function(t=0){const a=t>0?t:s(),n=jQuery("input:radio[name='mpg_url_mode_group']:checked").val(),o=jQuery("#mpg_url_constructor").html();let i="";o&&(i=d(o));const c=jQuery(".spaces-replacer.active").html();if(!i.includes("{{mpg_"))return void toastr.warning((0,e.__)("Your URL must contain at least one shortcode","multi-pages-plugin"),(0,e.__)("Wrong URL structure","multi-pages-plugin"));let l={action:"mpg_upsert_project_url_block",projectId:a,urlStructure:i.toLowerCase(),replacer:c,urlMode:n};r("source")&&(l.sourceType=r("source").type);let u=jQuery('input[name="direct_link_input"]:visible').val(),p=jQuery('select[name="periodicity"]:visible').val();u&&p&&"now"!==p&&"once"!==p&&(l.directLink=u,l.timezone=jQuery('input[name="mpg_timezone_name"]').val(),l.fetchDateTime=jQuery('input[name="datetime_upload_remote_file"]').val(),l.notificateAbout=jQuery('select[name="notification_level"]:visible').val(),l.notificationEmail=jQuery('input[name="notification_email"]:visible').val()),p&&(l.periodicity=p),l.update_modified_on_sync=jQuery('select[name="update_modified_on_sync"]').val(),jQuery('input[name="worksheet_id"]').val()?l.worksheetId=jQuery('input[name="worksheet_id"]:visible').val():l.worksheetId=null,l.securityNonce=backendData.securityNonce;let _=await jQuery.post(ajaxurl,l);JSON.parse(_).success?(toastr.success((0,e.__)("Project saved sucessully","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin")),delete l.securityNonce,delete l.notificationEmail,delete l.directLink,Object.keys(l).forEach((e=>(null==l[e]||void 0===l[e])&&delete l[e])),window?.tiTrk?.with("multi").set("save-changes-2",{feature:"dashboard-saved-changes",featureComponent:"project-url-block",value:l,groupId:a}),window?.tiTrk?.uploadEvents()):toastr.error((0,e.__)("Something went wrong while saving project data. Try reload page","multi-pages-plugin"),(0,e.__)("Can not update project","multi-pages-plugin"))}(n),setTimeout((()=>{window.location.href=backendData.projectPage+"&action=edit_project&id="+n}),1e3)}})),jQuery(".direct-link-schedule-form").on("submit",(async function(a){a.preventDefault();const n=jQuery(this).find("button");n.next("span.spinner").addClass("is-active"),n.attr("disabled",!0);var o=await k();await async function(a=0){jQuery('#upload_file input[name="mpg_upload_file_input"]').val("");const n=jQuery('#direct_link input[name="direct_link_input"]').val();if(!n)return void toastr.warning((0,e.__)("You need to paste link to file before using it","multi-pages-plugin"),(0,e.__)("Missing URL","multi-pages-plugin"));const o=a>1?a:s(),i=jQuery('input[name="worksheet_id"]').val().length?jQuery('input[name="worksheet_id"]').val():null;let l=await jQuery.post(ajaxurl,{action:"mpg_download_file_by_url",projectId:o,fileUrl:n,worksheetId:i,securityNonce:backendData.securityNonce});if(!l)return void toastr.error((0,e.__)("Something went wrong while saving project data. Try reload page","multi-pages-plugin"));let u=JSON.parse(l);if(!0!==u.success)throw u.error;t("source",{type:"direct_link",path:u.data.path}),toastr.success((0,e.__)("We will use this link to file as source","multi-pages-plugin"),(0,e.__)("Uploaded successfully!","multi-pages-plugin"),{timeOut:5e3});let p=await jQuery.post(ajaxurl,{action:"mpg_upsert_project_source_block",projectId:o,type:"direct_link",path:u.data.path,securityNonce:backendData.securityNonce}),d=JSON.parse(p);if(d.success){if(_(d)){const e=r("headers");Q(d,e),d.data.url_structure||c(e),jQuery('a[href="#shortcode"], a[href="#sitemap"], a[href="#spintax"]').removeClass("disabled")}jQuery("#mpg_next_cron_execution").text(d.data.nextExecutionTimestamp)}else toastr.error((0,e.__)("Something went wrong while saving project data. Try reload page","multi-pages-plugin"),(0,e.__)("Can not update project","multi-pages-plugin"))}(o),n.next("span.spinner").removeClass("is-active"),n.attr("disabled",!1)})),document.querySelector('input[name="mpg_enable_telemetry"]')?.addEventListener("change",(async function(t){const a=await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"mpg_options_update",securityNonce:backendData.securityNonce,enableTelemetry:t.target.checked?1:0})}),r=await a.json();r.success?toastr.success((0,e.__)("Success","multi-pages-plugin"),{timeOut:5e3}):(t.target.checked=!t.target.checked,toastr.error(r.error,(0,e.__)("Error","multi-pages-plugin")))})),["mpg_apply_condition","mpg_exclude_template_in_robots","mpg_participate_in_search","mpg_participate_in_default_loop"].forEach((e=>{const t=document.querySelector(`#${e}`);t&&t.addEventListener("change",(t=>{window.tiTrk?.with("multi").set(e,{feature:"dashboard",featureComponent:e,featureValue:{checked:t.target?.checked,inputValue:t.target?.value},groupId:"main"})}))})),document.querySelector("button.use-direct-link-button")?.addEventListener("click",(()=>{window.tiTrk?.with("multi").add({feature:"dashboard",featureComponent:"source-upload",featureValue:"direct-link",groupId:"main"})})),document.querySelector('input[name="mpg_upload_file_input"]')?.addEventListener("click",(()=>{window.tiTrk?.with("multi").add({feature:"dashboard",featureComponent:"source-upload",featureValue:"upload-file",groupId:"main"})})),document.querySelector('[data-cache-type="disk"] button.enable-cache')?.addEventListener("click",(e=>{window.tiTrk?.with("multi").set("enable-disk-cache",{feature:"dashboard",featureComponent:"disk",featureValue:e.target?.disabled?"disable":"enable",groupId:"cache"})})),document.querySelector('[data-cache-type="database"] button.enable-cache')?.addEventListener("click",(e=>{window.tiTrk?.with("multi").set("enable-disk-cache",{feature:"dashboard",featureComponent:"database",featureValue:e.target?.disabled?"disable":"enable",groupId:"cache"})})),document.querySelectorAll("button.flush-cache")?.forEach((e=>{e?.addEventListener("click",(()=>{window.tiTrk?.with("multi").add({feature:"dashboard",featureComponent:"flush",groupId:"cache"})}))})),document.querySelectorAll("#dataset_list li a").forEach((e=>{if(!e||!e.getAttribute("data-dataset-id"))return;const t=e.querySelector("span")?.innerText;t&&e.addEventListener("click",(a=>{window.tiTrk?.with("multi").add({feature:"setup",featureComponent:"preset",featureValue:{label:t,value:e.getAttribute("data-dataset-id")}}),window.tiTrk?.uploadEvents()}))})),await async function(){let n=s();if(n){t("projectId",n),jQuery("#mpg_project_id span").text(n),jQuery(".delete-project").show(),jQuery("#mpg-id-block").html("ID: "+n).removeClass("d-none");let o=await jQuery.ajax({url:ajaxurl,method:"post",data:{action:"mpg_get_project",securityNonce:backendData.securityNonce,projectId:n},statusCode:{500:function(t){toastr.error((0,e.__)("Looks like you attempt to use large source file, that reached memory allocated to PHP or reached max_post_size. Please, increase memory limit according to documentation for your web server. For additional information, check .log files of web server or","multi-pages-plugin")+`<a target="_blank" style="text-decoration: underline" href="https://docs.themeisle.com/article/1443-500-internal-server-error"> ${(0,e.__)("read our article","multi-pages-plugin")}</a>.`,(0,e.__)("Server settings limitation","multi-pages-plugin"),{timeOut:3e4})}}}),i=JSON.parse(o);if(!i.success)return void toastr.error(i.error,(0,e.__)("Can not get project data","multi-pages-plugin"));if(jQuery(".project-builder .project-name").val(i.data.name),jQuery(".project-builder .page-title h1").text(i.data.name),jQuery(".project-builder #mpg_entity_type_dropdown").val(i.data.entity_type),jQuery(".project-builder #mpg_apply_condition").val(i.data.apply_condition),jQuery("#mpg_exclude_template_in_robots").prop("checked",parseInt(i.data.exclude_in_robots)),jQuery("#mpg_participate_in_search").prop("checked",parseInt(i.data.participate_in_search)),jQuery("#mpg_participate_in_default_loop").prop("checked",parseInt(i.data.participate_in_default_loop)),b(i),jQuery(".cache-info .num-rows").text(i.data.spintax_cached_records_count),i.data.sitemap_url&&jQuery("#mpg_sitemap_url").html(`<a target="_blank" href="${i.data.sitemap_url}">${i.data.sitemap_url}</a>`),i.data.schedule_source_link&&jQuery('input[name="direct_link_input"]').val(i.data.schedule_source_link),i.data.schedule_periodicity=i.data.schedule_periodicity||"now",i.data.schedule_periodicity&&jQuery(`select[name="periodicity"] option[value="${i.data.schedule_periodicity}"]`).attr("selected","selected"),i.data.update_modified_on_sync&&jQuery('select[name="update_modified_on_sync"]').val(i.data.update_modified_on_sync),i.data.schedule_notificate_about&&jQuery(`select[name="notification_level"] option[value="${i.data.schedule_notificate_about}"]`).attr("selected","selected"),i.data.schedule_notification_email&&jQuery(`select[name="notification_email"] option[value="${i.data.schedule_notification_email}"]`).attr("selected","selected"),jQuery('input[name="worksheet_id"]').val(i.data.worksheet_id),jQuery(".worksheet-id").css({opacity:1,height:"initial"}),_(i)){jQuery('a[href="#shortcode"], a[href="#sitemap"],  a[href="#spintax"], a[href="#cache"],  a[href="#logs"], .save-changes-block button.disabled').removeClass("disabled");let e=r("headers");!function(){const e=r("headers"),t=jQuery(".shortcode-preview-output"),a=jQuery("#mpg_shortcode_tab_insert_shortcode_dropdown"),n=jQuery(".shortcode-headers-dropdown");let o;e.forEach(((e,t)=>{const a=e.startsWith("mpg_")?e:`mpg_${e}`;o+=`<option value="${t}" >${a}</option>`})),jQuery(".condition-container").append(g(o)),jQuery("#mpg_order_by").append(o),e.forEach((e=>{let a=e.toLowerCase().startsWith("mpg_")?e.toLowerCase().replace(/ /g,"_"):`mpg_${e.toLowerCase().replace(/ /g,"_")}`;n.append(new Option(a,a)),t.text(`{{${n.find("option:first-child").val()}}}`)})),a.empty(),e&&l(e,a),a.select2({width:"100%"});let i="mpg_shortcode_sandbox_textarea";jQuery(`#${i}`).on("blur",(function(){window.isTextareaBlured=!0})),a.on("change",(function(){let e=jQuery(this).find("option:selected").text();if(window.isTextareaBlured)p(i,`{{${e}}}`);else{const t=jQuery(`#${i}`).val().indexOf('"]');p(i,`{{${e}}}`,t+2)}}));const s=jQuery("#mpg_shortcode_sandbox_textarea").val().replace(/project-id="(.*?)"/gm,`project-id="${r("projectId")}"`);jQuery("#mpg_shortcode_sandbox_textarea").val(s),j()}(),jQuery("#collapse_1").removeClass("show"),Q(i,e)}if(i.data.name&&i.data.entity_type&&i.data.template_id){if(i.data.source_url_full&&jQuery("#mpg_in_use_dataset_link").attr("href",`${i.data.source_url_full}`).removeClass("disabled").text((0,e.__)("Download","multi-pages-plugin")),i.data.source_type&&(jQuery("#direct_link, #upload_file").hide(),jQuery("select.select-source-option").val(i.data.source_type),"upload_file"===i.data.source_type?jQuery('label[for="mpg_upload_file_input"]').text(i.data.source_url?.split("/")?.pop()):"direct_link"===i.data.source_type&&jQuery('input[name="direct_link_input"]').val(i.data.original_file_url)),jQuery('.project-builder section[data-id="2"]').show(),t("separator",i.data.space_replacer),i.data.nextExecutionTimestamp){let t=function(t){let a=new Date(1e3*t),r=a.getHours(),n="0"+a.getMinutes(),o="0"+a.getSeconds();var i=r+":"+n.substr(-2)+":"+o.substr(-2);let s=a.getMonth()+1<10?`0${a.getMonth()+1}`:a.getMonth()+1;return`${a.getFullYear()} ${s} ${a.getDate()} ${(0,e.__)("at","multi-pages-plugin")} ${i}`}(i.data.nextExecutionTimestamp);jQuery("#mpg_next_cron_execution").text(`Next scheduled execution: ${t}`),jQuery("#mpg_next_cron_execution").parents(".mpg-next-cron").show()}else jQuery("#mpg_next_cron_execution").parents(".mpg-next-cron").hide();jQuery(`#mpg_url_mode_group input[id="${i.data.url_mode}"]`).attr("checked","checked"),t("urlMode",i.data.url_mode);let n=i.data.url_structure;if(n)jQuery("#mpg_url_constructor").html(function(e){let t=`<div contenteditable="false" class="shortcode-chunk"><span class="close">${a}</span>`;return e.replace(/{{/g,t).replace(/}}/g,"</div>")}(n)).trigger("mpg_render_urls",["init"]);else{const e=r("headers");e&&c(e)}jQuery(".spaces-replacer").removeClass("active"),jQuery(".spaces-replacer").each(((e,t)=>{jQuery(t).html()===i.data.space_replacer&&jQuery(t).addClass("active")})),function(e){t("sitemapUrl",e.data.sitemap_url),t("sitemapFilename",e.data.sitemap_filename),t("sitemapMaxUrlPerFile",e.data.sitemap_max_url),t("sitemapFrequency",e.data.sitemap_update_frequency),t("sitemapAddToRobotsTxt",e.data.sitemap_add_to_robots),t("sitemapPriority",e.data.sitemap_priority)}(i),i.data.template_id&&jQuery("select#mpg_set_template_dropdown").parent("div").removeClass("col-sm-12 pr-0").addClass("col-sm-9").next("#mpg_edit_template_link").removeClass("d-none disabled").attr("href",(function(){return jQuery(this).data("edit_link").replace("#id#",i.data.template_id)}))}else jQuery('a[href="#shortcode"], a[href="#sitemap"], a[href="#spintax"], a[href="#logs"], .save-changes-block button.disabled').addClass("disabled")}else jQuery('a[href="#shortcode"], a[href="#sitemap"], a[href="#spintax"], a[href="#logs"], .save-changes-block button.disabled').addClass("disabled");jQuery("#mpg_main_tab_insert_shortcode_dropdown").select2({width:"100%"}),jQuery(document).on("change",".select-source-option",(function(){jQuery("#direct_link, #upload_file").hide();var e=jQuery(this).val();jQuery("#"+e).show(),"direct_link"===e&&(jQuery('input[name="direct_link_input"]').trigger("input"),jQuery('select[name="periodicity"], select[name="notification_level"]').trigger("change"))})),jQuery("select.select-source-option").trigger("change")}(),jQuery(".advanced-page").length&&(jQuery.post(ajaxurl,{action:"mpg_get_hook_name_and_priority",securityNonce:backendData.securityNonce}).then((t=>{let a=JSON.parse(t);a.success?a.data.hook_name&&a.data.hook_priority&&(jQuery("#mpg_hook_name").val(a.data.hook_name),jQuery("#mpg_hook_priority").val(a.data.hook_priority)):toastr.error(a.error,(0,e.__)("Failed","multi-pages-plugin"))})),jQuery.post(ajaxurl,{action:"mpg_get_basepath",securityNonce:backendData.securityNonce}).then((t=>{let a=JSON.parse(t);a.success?a.data&&jQuery(".mpg-path-block select").val(a.data):toastr.error(a.error,(0,e.__)("Failed","multi-pages-plugin"))})),jQuery.post(ajaxurl,{action:"mpg_get_cache_hook_name_and_priority",securityNonce:backendData.securityNonce}).then((t=>{let a=JSON.parse(t);a.success?a.data.cache_hook_name&&a.data.cache_hook_priority&&(jQuery("#mpg_cache_hook_name").val(a.data.cache_hook_name),jQuery("#mpg_cache_hook_priority").val(a.data.cache_hook_priority)):toastr.error(a.error,(0,e.__)("Failed","multi-pages-plugin"))})),jQuery.post(ajaxurl,{action:"mpg_get_branding_position",securityNonce:backendData.securityNonce}).then((t=>{let a=JSON.parse(t);a.success?a.data&&jQuery("#mpg_change_branding_position").val(a.data):toastr.error(a.error,(0,e.__)("Failed","multi-pages-plugin"))})).catch((e=>{console.log(e)}))),jQuery("#sitemap-form").on("submit",(async function(a){a.preventDefault();let n=jQuery('input[name="sitemap_filename_input"]').val(),o=jQuery('input[name="sitemap_max_urls_input"]').val(),i=jQuery('select[name="sitemap_frequency_input"] option:checked').val(),s=jQuery('input[name="sitemap_robot"]').is(":checked"),c=jQuery('input[name="sitemap_priority"]').val();const l=await jQuery.post(ajaxurl,{action:"mpg_check_is_sitemap_name_is_uniq",filename:n,securityNonce:backendData.securityNonce});let u=JSON.parse(l);u.success||toastr.error(u.error,(0,e.__)("Failed","multi-pages-plugin")),(u.unique||confirm(`"${n}" ${(0,e.__)('is already in use. Click "Ok" to override the sitemap, or "Cancel" to change name',"multi-pages-plugin")}`))&&await async function(a,n,o,i,s){const c=await jQuery.post(ajaxurl,{action:"mpg_generate_sitemap",projectId:r("projectId"),filename:a,maxUrlPerFile:n,frequency:o,addToRobotsTxt:i,previousSitemapName:r("sitemapFilename"),priority:s,securityNonce:backendData.securityNonce});let l=JSON.parse(c);l.success?(t("sitemapFilename",l.data.split("/").pop().replace(".xml","")),jQuery("#mpg_sitemap_url").html(`<a target="_blank" href="${l.data}">${l.data}</a>`),toastr.success(l.data,(0,e.__)("Success","multi-pages-plugin"),{timeOut:5e3})):toastr.error(l.error,(0,e.__)("Failed","multi-pages-plugin"))}(n,o,i,s,c)})),jQuery("#sitemap-tab").on("click",(function(){let t=jQuery('input[name="sitemap_filename_input"]'),a=jQuery('input[name="sitemap_max_urls_input"]'),n=jQuery('select[name="sitemap_frequency_input"]'),o=jQuery('input[name="sitemap_robot"]');jQuery('input[name="sitemap_priority"]').val(r("sitemapPriority")||1),t.val(r("sitemapFilename")),a.val(r("sitemapMaxUrlPerFile")||5e4);let i=r("sitemapAddToRobotsTxt");n.find(`option[value="${r("sitemapFrequency")}"]`).prop("selected",!0),o.prop("checked",parseInt(i)),r("sitemapUrl")?jQuery("#mpg_sitemap_url").html(`<a target="_blank" href="${r("sitemapUrl")}">${t.val()}</a>`):jQuery("#mpg_sitemap_url").html((0,e.__)("Not created yet","multi-pages-plugin"))})),function(){const t=jQuery("#mpg_spintax_input_textarea"),a=jQuery("#mpg_spintax_output_textarea");jQuery("#mpg_spin").on("click",(async function(){const e=t.val();jQuery(this).next("span.spinner").addClass("is-active"),jQuery(this).attr("disabled",!0);const r=await jQuery.post(ajaxurl,{action:"mpg_generate_spintax",spintaxString:e,securityNonce:backendData.securityNonce});let n=JSON.parse(r);n.success?a.html(n.data):toastr.error(n.error,"Failed"),jQuery(this).next("span.spinner").removeClass("is-active"),jQuery(this).removeAttr("disabled")})),jQuery(".copy-spintax-output").on("click",(function(){const a=Math.floor(1e3*Math.random())+100;o(`[mpg_spintax  project_id="${r("projectId")}" block_id="${a}"]${t.val()}[/mpg_spintax]`)&&toastr.success((0,e.__)("Spintax code copied to clipboard!","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin"),{timeOut:3e3})})),jQuery(".spintax-page .cache-info button").on("click",(async function(t){if(t.preventDefault(),confirm((0,e.__)("Are you sure, that you want to flush Spintax cache for current project? This action can not be undone.","multi-pages-plugin"))){let t=await jQuery.post(ajaxurl,{action:"mpg_flush_spintax_cache",projectId:r("projectId"),securityNonce:backendData.securityNonce}),a=JSON.parse(t);a.success||toastr.error(a.error,(0,e.__)("Can not flush Spintax cache","multi-pages-plugin")),toastr.success((0,e.__)("Spintax cache successfully flushed","multi-pages-plugin"),(0,e.__)("Done!","multi-pages-plugin")),jQuery(".cache-info .num-rows").text(0)}}))}(),jQuery("#cache").on("click",".card .enable-cache",(async function(){const t=jQuery(this).parent().attr("data-cache-type");["disk","database"].includes(t)||console.error("Passed unsupported type of cache");let a=await jQuery.post(ajaxurl,{action:"mpg_enable_cache",projectId:r("projectId"),type:t,securityNonce:backendData.securityNonce}),n=JSON.parse(a);n.success||toastr.error(n.error,(0,e.__)("Failed","multi-pages-plugin")),toastr.success(n.data,(0,e.__)("Success","multi-pages-plugin")),jQuery(".cache-page .card-footer button.btn").attr("disabled","disabled"),jQuery(`.cache-page div[data-cache-type=${t}] .enable-cache`).removeAttr("disabled").removeClass("btn-success enable-cache").addClass("btn-warning disable-cache").text("Disable"),jQuery(`.cache-page div[data-cache-type=${t}] .flush-cache`).removeAttr("disabled").removeClass("btn-light").addClass("btn-danger"),await x()})),jQuery("#cache").on("click",".card .disable-cache",(async function(){const t=jQuery(this).parent().attr("data-cache-type");["disk","database"].includes(t)||console.error("Passed unsupported type of cache");let a=await jQuery.post(ajaxurl,{action:"mpg_disable_cache",projectId:r("projectId"),type:t,securityNonce:backendData.securityNonce}),n=JSON.parse(a);n.success||toastr.error(n.error,(0,e.__)("Failed","multi-pages-plugin")),toastr.success(n.data,(0,e.__)("Success!","multi-pages-plugin")),jQuery(".cache-page .card-footer button.btn").removeAttr("disabled"),jQuery(".cache-page button.disable-cache").addClass("btn-success enable-cache").removeClass("btn-warning disable-cache").text("Enable"),jQuery(".cache-page button.flush-cache").attr("disabled","disabled").addClass("btn-light").removeClass("btn-danger"),await x()})),jQuery(".cache-page button.flush-cache").on("click",(async function(){if(confirm((0,e.__)("Are you sure, that you want to flush cache? This action can not be undone.","multi-pages-plugin"))){const t=jQuery(this).parent().attr("data-cache-type");let a=await jQuery.post(ajaxurl,{action:"mpg_flush_cache",projectId:r("projectId"),type:t,securityNonce:backendData.securityNonce}),n=JSON.parse(a);n.success||toastr.error(n.error,(0,e.__)("Failed","multi-pages-plugin")),toastr.success(n.data,(0,e.__)("Success","multi-pages-plugin")),await x()}})),jQuery("#cache-tab").on("click",x),jQuery('a[href="#logs"]').on("click",(function(){const t=r("projectId"),a={processing:!0,ajax:{url:`${ajaxurl}?action=mpg_get_log_by_project_id&projectId=${t}&securityNonce=${backendData.securityNonce}`,type:"POST"},columns:[{data:"id"},{data:"project_id"},{data:"level"},{data:"url"},{data:"message"},{data:"datetime"}],serverSide:!0,searching:!1,retrieve:!0,language:{lengthMenu:"Show _MENU_ entries"}};jQuery("#mpg_logs_table").DataTable(a),jQuery("#mpg_clear_log_by_project_id").on("click",(async function(){const t=r("projectId");let n=await jQuery.post(ajaxurl,{action:"mpg_clear_log_by_project_id",projectId:t,securityNonce:backendData.securityNonce}),o=JSON.parse(n);if(!o.success)return toastr.error(o.error,(0,e.__)("Can not clear log for current project","multi-pages-plugin")),!1;toastr.success((0,e.__)("Log was cleared","multi-pages-plugin"),(0,e.__)("Done!","multi-pages-plugin"));const i=jQuery("#mpg_logs_table");i.DataTable(a).clear().destroy(),i.empty(),i.DataTable(a)}))})),function(){if(jQuery(".dataset-library")){try{localStorage.getItem("is-analytics-sent")||new Promise(((e,t)=>{const a=document.createElement("script");a.onload=e,a.onerror=t,a.async=!0,a.src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js",document.head.appendChild(a)})).then((()=>FingerprintJS.load())).then((e=>e.get())).then((async e=>{const t=e.visitorId,a=await jQuery.post(ajaxurl,{action:"mpg_send_analytics_data",mpg_track_id:t,securityNonce:backendData.securityNonce});a&&JSON.parse(a)?.success&&localStorage.setItem("is-analytics-sent",!0)}))}catch(e){console.error(e)}let t=jQuery("input#filterinput"),a=jQuery("input#clearfilter"),r=jQuery("#mpg_result_count");jQuery("ul#dataset_list").listfilter({filter:t,clearlink:a,count:r}),jQuery("#dataset_list li a[data-dataset-id]").on("click",(async function(t){t.preventDefault(),jQuery("#dataset_list li a").css("pointer-events","none");const a=jQuery(this).attr("data-dataset-id");toastr.info("Dataset deployment started...","Info");let r=await jQuery.ajax({url:ajaxurl,method:"post",data:{action:"mpg_deploy_dataset",securityNonce:backendData.securityNonce,datasetId:a},statusCode:{500:function(t){toastr.error((0,e.__)("Looks like you attempt to use large source file, that reached memory allocated to PHP or reached max_post_size. Please, increase memory limit according to documentation for your web server. For additional information, check .log files of web server or","multi-pages-plugin")+`<a target="_blank" style="text-decoration: underline" href="https://docs.themeisle.com/article/1443-500-internal-server-error"> ${(0,e.__)("read our article","multi-pages-plugin")}</a>.`,(0,e.__)("Server settings limitation","multi-pages-plugin"),{timeOut:3e4})}}}),n=JSON.parse(r);if(!n.success)return toastr.error(n.error,"Can't deploy dataset. Details: "+n.error),jQuery("#dataset_list li a").css("pointer-events",backendData.isPro?"unset":"none"),!1;toastr.success("Dataset was successfully deployed. Wait few seconds","Deployed!"),setTimeout((()=>{location.href=`${backendData.projectPage}&action=edit_project&id=${n.data.projectId}`}),3e3)}))}}(),jQuery("#mpg_update_tables_structure").on("click",(async function(){const t=await jQuery.post(ajaxurl,{action:"mpg_activation_events",isAjax:!0,securityNonce:backendData.securityNonce});let a=JSON.parse(t);a.success?toastr.success((0,e.__)("MPG tables structure updated successfully","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin"),{timeOut:5e3}):toastr.error(a.error,(0,e.__)("Failed","multi-pages-plugin"))})),jQuery(".advanced-page .mpg-hooks-block").on("submit",(async function(t){t.preventDefault();const a=jQuery("#mpg_hook_name").val(),r=jQuery("#mpg_hook_priority").val(),n=await jQuery.post(ajaxurl,{action:"mpg_set_hook_name_and_priority",hook_name:a,hook_priority:r,securityNonce:backendData.securityNonce});let o=JSON.parse(n);o.success?toastr.success((0,e.__)("Hook settings updated sucessfully","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin"),{timeOut:5e3}):toastr.error(o.error,(0,e.__)("Failed","multi-pages-plugin"))})),jQuery(".advanced-page .mpg-path-block").on("submit",(async function(t){t.preventDefault();const a=jQuery(this).find("select").val(),r=await jQuery.post(ajaxurl,{action:"mpg_set_basepath",basepath:a,securityNonce:backendData.securityNonce});let n=JSON.parse(r);n.success?toastr.success((0,e.__)("Basepath settings updated sucessfully","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin"),{timeOut:5e3}):toastr.error(n.error,(0,e.__)("Failed","multi-pages-plugin"))})),jQuery(".advanced-page .mpg-cache-hooks-block").on("submit",(async function(t){t.preventDefault();const a=jQuery("#mpg_cache_hook_name").val(),r=jQuery("#mpg_cache_hook_priority").val(),n=await jQuery.post(ajaxurl,{action:"mpg_set_cache_hook_name_and_priority",cache_hook_name:a,cache_hook_priority:r,securityNonce:backendData.securityNonce});let o=JSON.parse(n);o.success?toastr.success((0,e.__)("Hook settings updated sucessfully","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin"),{timeOut:5e3}):toastr.error(o.error,(0,e.__)("Failed","multi-pages-plugin"))})),jQuery(".advanced-page .mpg-branding-position-block").on("submit",(async function(t){t.preventDefault();const a=jQuery("#mpg_change_branding_position").val(),r=await jQuery.post(ajaxurl,{action:"mpg_set_branding_position",branding_position:a||"left",securityNonce:backendData.securityNonce});let n=JSON.parse(r);n.success?toastr.success((0,e.__)("Hook settings updated sucessfully","multi-pages-plugin"),(0,e.__)("Success","multi-pages-plugin"),{timeOut:5e3}):toastr.error(n.error,(0,e.__)("Failed","multi-pages-plugin"))})),jQuery(".advanced-page .mpg-pro-license").on("submit",(async function(e){e.preventDefault();const t=jQuery(this);t.find(".btn-primary").attr("disabled",!0),jQuery.post(ajaxurl,jQuery(this).serialize(),(function(e){e.success?(toastr.success(e.message,{timeOut:5e3}),t.find(".btn-primary").removeAttr("disabled").text(e.button_text),"activate"===e.action?(t.find("#license_key").attr("disabled",!0).val(e.key),t.find('input[name="_action"]').val("deactivate"),t.find(".mpg-license-message").removeClass("d-none").html(e.expiration)):(t.find("#license_key").removeAttr("disabled").val(e.key),t.find('input[name="_action"]').val("activate"),t.find(".mpg-license-message").addClass("d-none"))):(toastr.error(e.message),t.find(".btn-primary").removeAttr("disabled"))}),"json")})),jQuery(".advanced-page #license_key").on("input",(function(){jQuery('.advanced-page input[name="license_key"]').val(jQuery(this).val())})),await async function(){if("mpg-search-settings"!==new URL(location.href).searchParams.get("page"))return;const t=await jQuery.post(ajaxurl,{action:"mpg_search_settings_get_options",securityNonce:backendData.securityNonce});let a=JSON.parse(t);if(a.success){const e=a?.data?.mpg_ss_result_template;jQuery("#mpg_search_settings_result_template").val(e?.replace(/\\\"/g,'"')),jQuery("#mpg_ss_intro_content").val(a?.data?.mpg_ss_intro_content?.replace(/\\\"/g,'"')),jQuery("#mpg_ss_results_container").val(a?.data?.mpg_ss_results_container),jQuery("#mpg_ss_excerpt_length").val(a?.data?.mpg_ss_excerpt_length),jQuery("#mpg_ss_results_count").val(a?.data?.mpg_ss_results_count),jQuery("#mpg_ss_is_case_sensitive").prop("checked",a?.data.mpg_ss_is_case_sensitive),jQuery("#mpg_ss_featured_image_url").val(a?.data?.mpg_ss_featured_image_url)}else toastr.error(a.error,(0,e.__)("Failed","multi-pages-plugin"));jQuery("#mpg_search_settings_form").on("submit",(async function(t){t.preventDefault();const a=jQuery("#mpg_search_settings_result_template").val(),r=jQuery("#mpg_ss_intro_content").val(),n=jQuery("#mpg_ss_results_container").val(),o=jQuery("#mpg_ss_excerpt_length").val(),i=jQuery("#mpg_ss_results_count").val(),s=jQuery("#mpg_ss_is_case_sensitive").prop("checked"),c=jQuery("#mpg_ss_featured_image_url").val(),l=await jQuery.post(ajaxurl,{action:"mpg_search_settings_upset_options",mpg_search_settings_result_template:a,mpg_ss_intro_content:r,mpg_ss_results_container:n,mpg_ss_excerpt_length:o,mpg_ss_results_count:i,mpg_ss_is_case_sensitive:s,mpg_ss_featured_image_url:c,securityNonce:backendData.securityNonce});let u=JSON.parse(l);u.success?toastr.success((0,e.__)("Success","multi-pages-plugin"),{timeOut:5e3}):toastr.error(u.error,(0,e.__)("Failed","multi-pages-plugin"))}))}()})),jQuery(document).ready((function(){jQuery.post(ajaxurl,{action:"mpg_get_permalink_structure",securityNonce:backendData.securityNonce}).then((t=>{let a=JSON.parse(t);a.success||toastr.error(a.error,"Checking permalink structure"),""===a.data&&toastr.warning(`${(0,e.__)("Your permailnk structure is Plain. MPG needed to change permalink structure to any other, like a /postname/. Do you want to","multi-pages-plugin")} <a href="#" style="color:green;" class="fix-permalink-structure">${(0,e.__)("fix it?","multi-pages-plugin")}</a>`,(0,e.__)("Wrong permalink structure","multi-pages-plugin"),{timeOut:1e4})})),tippy("[data-tippy-content]");let a=new Date;jQuery('input[name="datetime_upload_remote_file"]').datetimepicker({minuteStepping:1,minDate:"1/1/1900",minTime:`${a.getHours()}:${a.getMinutes()}`,step:10}),jQuery('input[name="mpg_timezone_name"]').val(Intl.DateTimeFormat().resolvedOptions().timeZone),t("limit",5)})),jQuery(document).on("click",".fix-permalink-structure",(function(t){t.preventDefault(),jQuery.post(ajaxurl,{action:"mpg_change_permalink_structure",securityNonce:backendData.securityNonce}).then((t=>{let a=JSON.parse(t);a.success?toastr.success(a.data,(0,e.__)("Success","multi-pages-plugin")):toastr.error((0,e.__)("Checking permalink structure failed, due to: ","multi-pages-plugin")+a.error,(0,e.__)("Failed","multi-pages-plugin"))}))})),jQuery(document).on("submit","form#subscribe-form",(function(e){e.preventDefault();var t=jQuery(this);t.addClass("sent");var a=jQuery(this).parents(".mpg-free-seo-guide");jQuery.post(ajaxurl,jQuery(this).serialize(),(function(e){e.status?(a?.find(".mpg-title")?.text(a.find(".mpg-title").data("success_title")),a?.find(".mpg-form-message")?.text(a.find(".mpg-form-message").data("success_message")),a?.find(".mpg-image img:not(.d-none)")?.addClass("d-none").next("img").removeClass("d-none")):(alert(e.message),t.removeClass("sent"))}),"json").fail((function(e){console.log(e),t.removeClass("sent")}))}))})();