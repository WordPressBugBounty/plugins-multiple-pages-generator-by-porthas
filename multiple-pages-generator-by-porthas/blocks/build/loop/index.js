(()=>{"use strict";var e={20:(e,t,o)=>{var r=o(609),l=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,o){var r,s={},p=null,c=null;for(r in void 0!==o&&(p=""+o),void 0!==t.key&&(p=""+t.key),void 0!==t.ref&&(c=t.ref),t)n.call(t,r)&&!i.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:l,type:e,key:p,ref:c,props:s,_owner:a.current}}},848:(e,t,o)=>{e.exports=o(20)},609:e=>{e.exports=window.React}},t={};function o(r){var l=t[r];if(void 0!==l)return l.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r=o(609);const l=window.wp.i18n,n=window.wp.blocks,a=window.wp.blockEditor,i=window.wp.element,s=window.wp.data,p=window.wp.serverSideRender;var c=o.n(p);const u=window.wp.components,m=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"mpg/loop","version":"0.1.0","title":"MPG Loop","category":"design","icon":"database-view","description":"MPG Loop block to build rich content based on the MPG project data","attributes":{"project_id":{"type":"integer","default":0},"limit":{"type":"integer","default":5},"uniqueRows":{"type":"boolean","default":false},"logic":{"type":"string","enum":["and","or"],"default":"and"},"orderBy":{"type":"string","default":""},"direction":{"enum":["asc","desc","random",""],"type":"string","default":""},"innerBlocksContent":{"type":"string","default":""},"conditions":{"type":"object","default":{"conditions":[],"logic":"all"},"properties":{"conditions":{"type":"array","items":{"type":"object","properties":{"column":{"type":"string"},"operator":{"type":"string"},"value":{"type":"string"}}}},"logic":{"type":"string","enum":["all","any"]}}}},"supports":{"align":["wide","full"],"anchor":true,"ariaLabel":true,"html":true,"color":{"gradients":true,"heading":true,"button":true,"link":true},"shadow":true,"spacing":{"margin":["top","bottom"],"padding":true,"blockGap":true},"dimensions":{"minHeight":true},"typography":{"fontSize":true,"lineHeight":true}},"editorScript":"file:./index.js","editorStyle":"file:./editor.css","textdomain":"multiple-pages-generator-by-porthas"}'),d=window.wp.primitives;var g=o(848);const b=(0,g.jsx)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)(d.Path,{d:"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"})}),y=(0,g.jsx)(d.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)(d.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),h=(0,g.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(d.Path,{d:"m13.06 12 6.47-6.47-1.06-1.06L12 10.94 5.53 4.47 4.47 5.53 10.94 12l-6.47 6.47 1.06 1.06L12 13.06l6.47 6.47 1.06-1.06L13.06 12Z"})}),w=(0,g.jsx)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(d.Path,{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})}),_=({conditions:e,updateConditions:t,operators:o,CompareOperators:n,labels:a={},columnOptions:s})=>{const[p,c]=(0,i.useState)([]),m={applyFilters:(0,l.__)("How to Apply Filters","multiple-pages-generator-by-porthas"),matchAll:(0,l.__)("Show items that match all filters","multiple-pages-generator-by-porthas"),matchAny:(0,l.__)("Show items that match any filter","multiple-pages-generator-by-porthas"),emptyFilter:(0,l.__)("Empty filter","multiple-pages-generator-by-porthas"),collapse:(0,l.__)("Collapse","multiple-pages-generator-by-porthas"),expand:(0,l.__)("Expand","multiple-pages-generator-by-porthas"),removeFilter:(0,l.__)("Remove filter","multiple-pages-generator-by-porthas"),column:(0,l.__)("Column","multiple-pages-generator-by-porthas"),selectColumn:(0,l.__)("Select a column...","multiple-pages-generator-by-porthas"),operator:(0,l.__)("Operator","multiple-pages-generator-by-porthas"),value:(0,l.__)("Value","multiple-pages-generator-by-porthas"),addFilter:(0,l.__)("Add filter","multiple-pages-generator-by-porthas"),...a},d=(o,r,l)=>{const n=[...e.conditions];n[o][r]=l,t({...e,conditions:n})},g=e=>{if(!e.column)return m.emptyFilter;let t=`${e.column}`;return e.operator&&(t+=` ${_(e.operator).toLowerCase()}`,n.includes(e.operator)&&e.value&&(t+=` ${e.value}`)),{short:t.length>15?t.substring(0,12)+"...":t,full:t}},_=e=>{const t=o.find((t=>t.value===e));return t?t.label:e};return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(u.SelectControl,{label:m.applyFilters,value:e.logic,options:[{label:m.matchAll,value:"all"},{label:m.matchAny,value:"any"}],onChange:o=>{t({...e,logic:o})}}),e.conditions.map(((l,a)=>(0,r.createElement)("div",{key:a,style:{marginBottom:"10px",padding:"0px 10px",border:"1px solid #ccc"}},(0,r.createElement)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},(0,r.createElement)("strong",{title:g(l).full},g(l).short),(0,r.createElement)("div",null,(0,r.createElement)(u.IconButton,{icon:p[a]?b:y,label:p[a]?m.collapse:m.expand,onClick:()=>(e=>{c((t=>{const o=[...t];return o[e]=!o[e],o}))})(a)}),(0,r.createElement)(u.IconButton,{icon:h,label:m.removeFilter,onClick:()=>(o=>{const r=[...e.conditions];r.splice(o,1),t({...e,conditions:r})})(a)}))),p[a]&&(0,r.createElement)(r.Fragment,null,s?(0,r.createElement)(u.SelectControl,{label:m.column,value:l.column,options:[{value:"",label:m.selectColumn},...s],onChange:e=>d(a,"column",e)}):(0,r.createElement)(u.TextControl,{label:m.column,value:l.column,onChange:e=>d(a,"column",e)}),(0,r.createElement)(u.SelectControl,{label:m.operator,value:l.operator,options:o,onChange:e=>d(a,"operator",e)}),n.includes(l.operator)&&(0,r.createElement)(u.TextControl,{label:m.value,value:l.value,onChange:e=>d(a,"value",e)}))))),e.conditions.length<10&&(0,r.createElement)(u.Button,{isSecondary:!0,onClick:()=>{if(e.conditions.length<10){const r=e.conditions.length;t({...e,conditions:[...e.conditions,{column:"",operator:o[0].value,value:""}]}),c((e=>{const t=[...e];return t[r]=!0,t}))}},icon:w},m.addFilter))},{name:v}=m;(0,n.registerBlockType)(v,{...m,edit:({attributes:e,setAttributes:t,clientId:o})=>{const{project_id:n,direction:p,conditions:m}=e,d=(0,a.useBlockProps)();(0,i.useEffect)((()=>{}),[e]);const[g,b]=(0,i.useState)(!1),[y,h]=(0,i.useState)(""),{selectBlock:w}=(0,s.useDispatch)("core/block-editor"),v=window.mpgLoop?Object.entries(window.mpgLoop.projects).map((([e,t])=>({value:e,label:t}))):[],f=window.mpgLoop?Object.entries(window.mpgLoop.orders).map((([e,t])=>({value:e,label:t}))):[],E=(0,s.useSelect)((e=>{const{isBlockSelected:t,hasSelectedInnerBlock:r}=e("core/block-editor");return t(o)||r(o,!0)}),[o]);(0,i.useEffect)((()=>{E&&b(!1)}),[E]);const{getBlocks:C}=(0,s.useSelect)((e=>e("core/block-editor")));(0,i.useEffect)((()=>{const e=()=>{const e=C(o),t=wp.blocks.serialize(e);h(t)};e();const t=wp.data.subscribe((()=>{e()}));return()=>t()}),[o,C]);const k=window.mpgLoop&&n?window.mpgLoop.projectHeaders[n]:[],x=window.mpgLoop.operators||[],S=k.map((e=>({value:e,label:e}))),B=Object.entries(x).map((([e,t])=>({label:t,value:e}))),j=Object.keys(window.mpgLoop.compareOperators)||[],O=(0,s.useSelect)((e=>{const{getBlockOrder:t}=e("core/block-editor");return t(o).length>0}),[o]);return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(a.InspectorControls,null,(0,r.createElement)(u.PanelBody,{className:"mpg-loop-settings",title:(0,l.__)("Loop Settings","multiple-pages-generator-by-porthas")},(0,r.createElement)(u.SelectControl,{label:(0,l.__)("Select Project","multiple-pages-generator-by-porthas"),value:e.project_id,options:[{value:0,label:(0,l.__)("Select a project...","multiple-pages-generator-by-porthas")},...v],onChange:e=>{t({project_id:parseInt(e)}),b(!1)}}),n>0&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)(u.TextControl,{label:(0,l.__)("Limit","multiple-pages-generator-by-porthas"),value:e.limit,type:"number",onChange:e=>t({limit:parseInt(e)}),help:(0,l.__)("Number of maximum items to display.","multiple-pages-generator-by-porthas")}),(0,r.createElement)(u.ToggleControl,{label:(0,l.__)("Unique Rows","multiple-pages-generator-by-porthas"),checked:e.uniqueRows,onChange:e=>t({uniqueRows:e}),help:(0,l.__)("Display only unique rows","multiple-pages-generator-by-porthas")}),(0,r.createElement)(u.SelectControl,{label:(0,l.__)("Ordering","multiple-pages-generator-by-porthas"),value:e.direction,options:[{value:"",label:"..."},...f],onChange:e=>t({direction:e})}),("asc"===p||"desc"===p)&&(0,r.createElement)(u.SelectControl,{label:(0,l.__)("Order By","multiple-pages-generator-by-porthas"),value:e.orderBy,options:[{value:"",label:(0,l.__)("Select a column...","multiple-pages-generator-by-porthas")},...S],onChange:e=>t({orderBy:e}),help:(0,l.__)("Column name to order by","multiple-pages-generator-by-porthas")}),(0,r.createElement)(u.Button,{isPrimary:!0,onClick:()=>{b(!0),w(null)}},(0,l.__)("Preview Loop","multiple-pages-generator-by-porthas")))),(0,r.createElement)(u.PanelBody,{title:(0,l.__)("Loop Filters","multiple-pages-generator-by-porthas"),initialOpen:!0,className:"mpg-loop-filters "+(n>0?"":"hidden"),insertAfter:"mpg-loop-settings"},(0,r.createElement)(_,{conditions:m,updateConditions:e=>{t({conditions:e})},columnOptions:S,operators:B,CompareOperators:j}))),(0,r.createElement)("div",{...d},g&&!E?(0,r.createElement)(c(),{block:"mpg/loop",attributes:{...e,innerBlocksContent:y},httpMethod:"POST"}):(0,r.createElement)(a.InnerBlocks,{renderAppender:()=>O?(0,r.createElement)(a.InnerBlocks.DefaultBlockAppender,null):(0,r.createElement)(a.ButtonBlockAppender,{rootClientId:o,className:"wp-block-mpg-loop__appender"})})))},save:()=>{const e=a.useBlockProps.save();return(0,r.createElement)("div",{...e},(0,r.createElement)(a.InnerBlocks.Content,null))}})})();